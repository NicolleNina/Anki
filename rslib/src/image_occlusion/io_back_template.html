<div style="display: none">{{cloze:Occlusions}}</div>

<canvas
    id="canvas"
    style="background-size: 100% 100%; max-width: 100%; max-height: 90vh"
>
</canvas>

<div style="display: none">{{Image}}</div>

{{Notes}}

<script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var img = new Image();

    img.onload = function () {
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
        drawShapes(ctx);
    };

    img.src = document.getElementById("img").src;

    function drawShapes(ctx) {
        var ioCloze = document.getElementById("io_cloze");
        for (cloze of ioCloze.children) {
            var shape = cloze.getAttribute("shape");
            var xywh = cloze.getAttribute("ioxywh");
            xywh = xywh.split(",").map(Number);

            if (cloze.children.length) {
                if (
                    cloze.children[0].className == "cloze" &&
                    cloze.children[0].innerText == "[prompted]"
                ) {
                    draw(shape, "red", xywh);
                }
            } else {
                if (cloze.innerText.trim() == "shown") {
                    draw(shape, "green", xywh);
                }
            }
        }
    }

    function draw(shape, color, xywh) {
        ctx.fillStyle = color;

        switch (shape) {
            case "rect":
                ctx.fillRect(xywh[0], xywh[1], xywh[2], xywh[3]);
                break;
        }
    }
</script>
